<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Finance - Dashboard</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo-small">
                <span class="logo-icon">ğŸ’</span>
                <span class="logo-text">Smart Finance</span>
            </div>
        </div>
        
        <nav class="sidebar-nav">
            <a href="/dashboard" class="nav-item active">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-text">Resumen</span>
            </a>
            <a href="/inversiones" class="nav-item">
                <span class="nav-icon">ğŸ“ˆ</span>
                <span class="nav-text">Inversiones</span>
            </a>
            <a href="/gastos" class="nav-item">
                <span class="nav-icon">ğŸ’¸</span>
                <span class="nav-text">Gastos</span>
            </a>
            <a href="/analisis" class="nav-item">
                <span class="nav-icon">ğŸ“Š</span>
                <span class="nav-text">AnÃ¡lisis</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-profile">
                <div class="user-avatar">ğŸ‘¤</div>
                <div class="user-info">
                    <div class="user-name" id="sidebar-username">Usuario</div>
                    <div class="user-role" id="sidebar-role">user</div>
                </div>
            </div>
            <button class="btn-logout" id="logout-btn">
                <span>Cerrar SesiÃ³n</span>
                <span>ğŸšª</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <h1 class="page-title">Resumen General</h1>
                <p class="page-subtitle">Vista general de tus finanzas</p>
            </div>
            <div class="header-right">
                <div class="header-stats">
                    <div class="stat-badge balance-badge" id="header-balance">
                        <span class="stat-label">Balance</span>
                        <span class="stat-value">$0</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="cards-grid">
            <div class="stat-card stat-card-primary">
                <div class="stat-card-icon">ğŸ’°</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Total Inversiones</div>
                    <div class="stat-card-value" id="total-inversiones">$0</div>
                    <div class="stat-card-change positive">+0% este mes</div>
                </div>
            </div>
            
            <div class="stat-card stat-card-danger">
                <div class="stat-card-icon">ğŸ’¸</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Total Gastos</div>
                    <div class="stat-card-value" id="total-gastos">$0</div>
                    <div class="stat-card-change negative">-0% este mes</div>
                </div>
            </div>
            
            <div class="stat-card stat-card-success">
                <div class="stat-card-icon">ğŸ“Š</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Balance</div>
                    <div class="stat-card-value" id="balance">$0</div>
                    <div class="stat-card-change" id="ahorro-badge">0% de ahorro</div>
                </div>
            </div>
            
            <div class="stat-card stat-card-info">
                <div class="stat-card-icon">ğŸ¯</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Porcentaje Ahorro</div>
                    <div class="stat-card-value" id="porcentaje-ahorro">0%</div>
                    <div class="stat-card-change">Meta: 20%</div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="charts-container">
            <div class="chart-card">
                <h3 class="chart-title">DistribuciÃ³n de Gastos</h3>
                <div id="gastos-chart" class="chart-placeholder">
                    <div class="no-data">No hay datos disponibles</div>
                </div>
            </div>
            
            <div class="chart-card">
                <h3 class="chart-title">DistribuciÃ³n de Inversiones</h3>
                <div id="inversiones-chart" class="chart-placeholder">
                    <div class="no-data">No hay datos disponibles</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 2rem;">
            <a href="/inversiones" class="stat-card" style="cursor: pointer; text-decoration: none;">
                <div class="stat-card-icon">â•</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Nueva InversiÃ³n</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem;">Registra un nuevo ingreso</div>
                </div>
            </a>
            
            <a href="/gastos" class="stat-card" style="cursor: pointer; text-decoration: none;">
                <div class="stat-card-icon">â–</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Nuevo Gasto</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem;">Registra un nuevo egreso</div>
                </div>
            </a>
            
            <a href="/analisis" class="stat-card" style="cursor: pointer; text-decoration: none;">
                <div class="stat-card-icon">ğŸ“Š</div>
                <div class="stat-card-content">
                    <div class="stat-card-label">Ver AnÃ¡lisis</div>
                    <div style="color: var(--text-secondary); font-size: 0.875rem;">Reportes detallados</div>
                </div>
            </a>
        </div>
    </main>

    <!-- BotÃ³n flotante del chatbot -->
    <button class="btn-chat-float" id="chat-toggle-btn" title="Asistente IA">
        <span>ğŸ¤–</span>
    </button>

    <!-- Modal Chatbot -->
    <div id="chat-modal" class="modal-chat">
        <div class="chat-modal-content">
            <div class="chat-modal-header">
                <h3>ğŸ¤– Asistente Financiero IA</h3>
                <button class="chat-modal-close" id="chat-close-btn">&times;</button>
            </div>
            <div class="chat-messages" id="chat-messages">
                <div class="chat-message bot-message">
                    <div class="message-avatar">ğŸ¤–</div>
                    <div class="message-content">
                        <div class="message-text">Â¡Hola! Soy tu asistente financiero IA. Â¿En quÃ© puedo ayudarte hoy?</div>
                    </div>
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" id="chat-input" placeholder="Escribe tu pregunta aquÃ­..." class="chat-input">
                <button id="chat-send" class="btn-send">Enviar</button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast" class="toast"></div>

    <!-- Scripts -->
    <script src="/static/js/config.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/chat.js"></script>
    <script>
        // InicializaciÃ³n del dashboard
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('ğŸš€ Inicializando Dashboard...');
            
            if (!checkAuth()) return;
            
            await loadUserProfile();
            setupChatbot();
            await loadDashboardData();
            
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            console.log('âœ… Dashboard inicializado');
        });
    </script>
</body>
</html>